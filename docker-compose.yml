services:
  skylogs-back:
    container_name: skylogs-back
    image: "${IMAGE_TAG_BACK}"
    restart: unless-stopped
    environment:
     - DEPLOY_TYPE=web
    ports:
     - 9001:9000
    volumes:
      - skylogs_back:/var/www/html:rw
    networks:
      - skylogs
    depends_on:
      - mongodb
      - redis

  skylogs-front:
    container_name: skylogs-front
    image: "${IMAGE_TAG_FRONT}"
    restart: unless-stopped
    ports:
     - 8080:3000
    networks:
      - skylogs
    depends_on:
      - nginx_back
      
  horizon:
    container_name: skylogs_horizon
    image: "${IMAGE_TAG_BACK}"
    environment:
     - DEPLOY_TYPE=horizon
    restart: unless-stopped
    depends_on:
      - mongodb
      - redis
    networks:
      - skylogs

  crontab:
    container_name: skylogs_crontab
    image: "${IMAGE_TAG_BACK}"
    environment:
     - DEPLOY_TYPE=crontab
    restart: unless-stopped
    depends_on:
      - mongodb
      - redis
    networks:
      - skylogs



########### MONGODB ############
  mongodb:
    image: mongo:4.4 
    ports:
     - 27017:27017
    environment:
     - MONGO_INITDB_ROOT_USERNAME=admin
     - MONGO_INITDB_ROOT_PASSWORD=TuY8dgQP52p6nHEMSe4rhk
    volumes:
      - mongo_data:/data/db
    networks:
      - skylogs

########### REDIS ############
  redis:
    image: redis:6.2-alpine
    restart: always
    ports:
      - '6379:6379'
    command: redis-server --save 60 1 --loglevel warning --requirepass ASdfasdfa097sdfg
    networks:
      - skylogs

########## NGINX ############
  nginx_back:
    image: nginx:alpine
    container_name: nginx_back
    restart: unless-stopped
    ports:
      - "8083:80"
    volumes:
      - skylogs_back:/var/www/html:ro
      - ./apps/backend/nginx.conf:/etc/nginx/conf.d/default.conf
    networks:
      - skylogs
    depends_on:
      - skylogs-back
networks:
  skylogs:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: "192.168.17.0/24"  # Define the subnet range
          gateway: "192.168.17.1"     # Define the gateway

volumes:
  skylogs_back:
    driver: local
  mongo_data:
    driver: local

